---
import Layout from "../../layouts/Layout.astro";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";

export async function getStaticPaths() {
  return [
    { params: { locale: 'en' } },
    { params: { locale: 'cy' } },
  ];
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang)
---
<script>
  document.addEventListener("DOMContentLoaded", () => {
  const formHandlerResponse = new URLSearchParams(window.location.search).get(
    "success"
  );

  if (!formHandlerResponse) return;

  const form = document.getElementById("contact-form");

  if(!form) return;

  /**
   * @type {HTMLTemplateElement | null}
   */
  const submissionSuccessTemplate = document.querySelector(
    'template[name="submission-success"]'
  );

  if(!submissionSuccessTemplate) return;

  const formParent = form?.parentElement;

  formParent?.removeChild(form);

  formParent?.appendChild(
    submissionSuccessTemplate.content  
  );
});
</script>
<Layout locale={lang} pageTitle={t("Contact Us")} pageDescription={t("Get in touch with us today")} pageUrl={`contact`}>
  <section class="container max-w-3xl px-2 mx-auto mb-12 lg:mb-24">
    <h1 class="text-2xl mb-4">{t("Contact Us")}</h1>
    <p class="mb-6">
      {t("Get in touch with us! We'd be happy to hear from you. We try to respond quickly but it depends how busy we are!")}
    </p>
    <form id="contact-form" name="contact" method="POST" data-netlify="true" action={`/${lang}/contact?success=true`} class="space-y-4 max-w-md mb-6">
      <div class="form-control w-full">
        <label class="label" for="your-name">
          <span class="label-text">{t("Your name")}</span>
        </label>
        <input type="text" name="name" id="your-name" placeholder="John Smith" required maxlength="40" minlength="3" class="input input-bordered w-full" />
      </div>
      <div class="form-control w-full">
        <label class="label" for="your-company">
          <span class="label-text">{t("your company")}</span>
        </label>
        <input type="text" name="company" id="your-company" placeholder="Your Company" required maxlength="40" minlength="3" class="input input-bordered w-full" />
      </div>
      <div class="form-control w-full">
        <label class="label" for="your-email">
          <span class="label-text">{t("your email")}</span>
        </label>
        <input type="email" name="email" id="your-email" placeholder="name@example.com" required maxlength="40" minlength="3" class="input input-bordered w-full" />
      </div>
      <div class="form-control w-full">
        <label class="label" for="your-enquiry">
          <span class="label-text">{t("your enquiry")}</span>
        </label>
        <textarea name="enquiry" id="your-enquiry" placeholder="Tell us about your enquiry..." required maxlength="180" minlength="3" class="textarea textarea-bordered w-full h-32" rows="4"/>
      </div>
      <button type="submit" class="btn btn-primary w-full">{t("Send")}</button>
    </form>
    <template name="submission-success">
      <div>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="32px">
          <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
        </svg>
        <p>{t("Thank you for your message. We will be in touch shortly")}.</p>
      </div>
    </template>
  </section>
</Layout>
