---
import Layout from "../../layouts/Layout.astro";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";

export async function getStaticPaths() {
  return [
    { params: { locale: 'en' } },
    { params: { locale: 'cy' } },
  ];
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang)
---
<script>
  document.addEventListener("DOMContentLoaded", () => {
  const formHandlerResponse = new URLSearchParams(window.location.search).get(
    "success"
  );

  if (!formHandlerResponse) return;

  const form = document.getElementById("contact-form");

  if(!form) return;

  /**
   * @type {HTMLTemplateElement | null}
   */
  const submissionSuccessTemplate = document.querySelector(
    'template[name="submission-success"]'
  );

  if(!submissionSuccessTemplate) return;

  const formParent = form?.parentElement;

  formParent?.removeChild(form);

  formParent?.appendChild(
    submissionSuccessTemplate.content  
  );
});
</script>
<Layout locale={lang} pageTitle={t("Contact Us")} pageDescription={t("Get in touch with us today")} pageUrl={`/${lang}/contact/`}>
  <section>
    <h1>{t("Contact Us")}</h1>
    <p>{t("We'd love to hear from you! We typically respond within 2 working days")}.</p>
    <form id="contact-form" name="contact" method="POST" data-netlify="true" action={`/${lang}/contact?success=true`}>
      <label for="your-name">{t("Your name")}</label>
      <input type="text" name="name" id="your-name" placeholder="name" required maxlength="40" minlength="3">
      <label for="your-company">{t("your company")}</label>
      <input type="text" name="company" id="your-company" placeholder="company" required maxlength="40" minlength="3">
      <label for="your-email">{t("your email")}</label>
      <input type="email" name="email" id="your-email" placeholder="email" required maxlength="40" minlength="3">
      <label for="your-enquiry">{t("your enquiry")}</label>
      <textarea name="enquiry" id="your-enquiry" placeholder="your enquiry" required maxlength="180" minlength="3"/>
      <input type="submit" value={t("Send")}>
    </form>
    <template name="submission-success">
      <div>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="32px">
          <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" />
        </svg>
        <p>{t("Thank you for your message. We will be in touch shortly")}.</p>
      </div>
    </template>
  </section>
</Layout>
